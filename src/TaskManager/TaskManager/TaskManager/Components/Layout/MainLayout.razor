@using TaskManager.Client.Components.Layout
@inherits LayoutComponentBase

<div class="app-layout">
    <!-- SIDEBAR -->
    <NavMenu />

    <!-- MAIN CONTENT -->
    <main class="app-main">
        <!-- Header Component -->
        <Header NotificationCount="3"
                ShowAddButton="true"
                AddButtonText="Add Task" />

        <!-- Page Content -->
        <div class="content-body">
            @Body
        </div>
    </main>
</div>

<style>
    /* APP LAYOUT */
    .app-layout {
        display: flex;
        min-height: 100vh;
        background: var(--bg-main);
        position: relative;
    }

    /* MAIN CONTENT */
    .app-main {
        flex: 1;
        margin-left: var(--sidebar-width);
        transition: margin-left 0.3s ease;
        display: flex;
        flex-direction: column;
        min-width: 0;
        width: 100%;
    }

    /* CONTENT BODY */
    .content-body {
        flex: 1;
        padding: 0 var(--space-xl) var(--space-xl);
        overflow-x: auto;
    }

    /* Reduce top padding for landing page */
    .landing-page {
        margin-top: calc(var(--space-lg) * -1);
    }

    /* RESPONSIVE */
    @@media (max-width: 1024px) {
        .app-main {
            margin-left: 0 !important;
        }

        .content-body {
            padding: 0 var(--space-lg) var(--space-lg);
        }
    }

    @@media (max-width: 768px) {
        .content-body {
            padding: 0 var(--space-md) var(--space-md);
        }
    }

    @@media (max-width: 480px) {
        .content-body {
            padding: 0 var(--space-sm) var(--space-sm);
        }
    }
</style>

<script>
    // Remove sidebar margin when sidebar is not visible (user logged out)
    (function() {
        function adjustMainMargin() {
            const sidebar = document.querySelector('.app-sidebar');
            const mainContent = document.querySelector('.app-main');

            if (mainContent) {
                if (!sidebar || window.getComputedStyle(sidebar).display === 'none') {
                    mainContent.style.marginLeft = '0';
                } else if (window.innerWidth > 1024) {
                    const collapsed = sidebar.classList.contains('collapsed');
                    mainContent.style.marginLeft = collapsed ? '80px' : '250px';
                }
            }
        }

        // Run on load and when sidebar changes
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', adjustMainMargin);
        } else {
            adjustMainMargin();
        }

        // Watch for sidebar changes
        const observer = new MutationObserver(adjustMainMargin);
        observer.observe(document.body, { childList: true, subtree: true });

        // Also check periodically for the first few seconds
        let checks = 0;
        const interval = setInterval(() => {
            adjustMainMargin();
            checks++;
            if (checks > 10) clearInterval(interval);
        }, 200);
    })();
</script>